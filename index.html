<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRDV Tactical V35</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#0b1116;color:#fff}
header{padding:16px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #162028;color:#18ff9c;font-weight:700}
.container{padding:16px}
.card{background:#141c22;padding:16px;border-radius:18px;margin-bottom:14px;box-shadow:0 25px 60px rgba(0,0,0,.7)}
button{margin-top:8px;padding:8px 12px;border:none;border-radius:10px;font-weight:600;background:#18ff9c;cursor:pointer}
input{width:100%;padding:8px;margin-top:6px;border-radius:10px;border:none;background:#1c2730;color:#fff}
.green{color:#18ff9c}
.amber{color:#ffb020}
.red{color:#ff4d4d}
.phase{padding:6px 10px;border-radius:10px;font-size:12px;margin-bottom:8px;display:inline-block}
.base{background:#224c3a}
.build{background:#3a3322}
.peak{background:#4c2222}
.stat{font-weight:700;font-size:18px;margin-top:6px}
.map-grid{display:grid;grid-template-columns:repeat(10,1fr);gap:4px;margin-top:10px}
.map-box{height:12px;border-radius:4px;background:#1c2730}
.map-box.active{background:#18ff9c}
.warning{background:#401d1d}
.good{background:#183a2d}
.subtle{opacity:.7;font-size:13px;margin-top:6px}
</style>
</head>

<body>

<header>
PRDV Tactical V35
<div id="countdown"></div>
</header>

<div class="container">

<div id="dashboard"></div>
<div id="workout"></div>
<div id="prPanel"></div>
<div id="roadmap"></div>
<div id="analytics"></div>

</div>

<script>

/* ===============================
   CORE DATES
================================ */

const START = new Date();
const TARGET = new Date("2026-04-27");
let chart=null;

/* ===============================
   COUNTDOWN
================================ */

function updateCountdown(){
  const d=Math.ceil((TARGET-new Date())/86400000);
  document.getElementById("countdown").innerText=d+" days";
}
updateCountdown();

/* ===============================
   WEEK + PHASE
================================ */

function getWeek(){
  const diff=Math.floor((new Date()-START)/86400000);
  return Math.min(Math.floor(diff/7)+1,10);
}
function getPhase(){
  const w=getWeek();
  if(w<=3) return "BASE";
  if(w<=7) return "BUILD";
  return "PEAK";
}
function isDeload(){ return getWeek()%4===0 }

/* ===============================
   SESSION STORAGE
================================ */

function saveSession(ex,load,rpe,left,right){
  localStorage.setItem(
    "session-"+Date.now(),
    JSON.stringify({
      exercise:ex,
      load:+load,
      rpe:+rpe,
      left:+left||0,
      right:+right||0,
      date:new Date().toDateString()
    })
  );
  render();
}
function getSessions(){
  return Object.keys(localStorage)
    .filter(k=>k.startsWith("session-"))
    .map(k=>JSON.parse(localStorage.getItem(k)));
}

/* ===============================
   PR TRACKING
================================ */

function getPR(exercise){
  const sessions=getSessions().filter(s=>s.exercise===exercise);
  if(!sessions.length) return 0;
  return Math.max(...sessions.map(s=>s.load));
}

/* ===============================
   LOAD + FATIGUE
================================ */

function acuteLoad(){
  return getSessions().slice(-7).reduce((a,b)=>a+b.load,0);
}
function chronicLoad(){
  return getSessions().slice(-28).reduce((a,b)=>a+b.load,0)/4||1;
}
function acwr(){
  return (acuteLoad()/chronicLoad()).toFixed(2);
}
function fatigue(){
  const s=getSessions().slice(-5);
  if(!s.length) return 20;
  return s.reduce((a,b)=>a+b.rpe,0)/s.length;
}

/* ===============================
   PERFORMANCE MODEL
================================ */

function projected2km(){
  const base=470;
  const improvement=getWeek()*2;
  const fatiguePenalty=fatigue()*1.5;
  return Math.max(420,base-improvement-fatiguePenalty);
}
function vo2Estimate(){
  const time=projected2km();
  return (483/time)+3.5;
}

/* ===============================
   SELECTION INDEX
================================ */

function selectionIndex(){
  const score=100-(fatigue()*3)+(getWeek()*2);
  return Math.min(100,Math.max(50,score));
}

/* ===============================
   WORKOUT ENGINE (DYNAMIC)
================================ */

function getWorkout(){

  const split=(projected2km()/5).toFixed(1);
  const fatigueLevel=fatigue();

  if(isDeload())
    return "DELOAD WEEK — Reduce volume 30%";

  if(fatigueLevel>7)
    return "High Fatigue — Swap session for Zone 2 + Mobility";

  return `
VO2: 6-8 x 400m @ ${split}s
Lower Unilateral: Bulgarian Split Squat 4x8
Tempo: 3 x 1km
  `;
}

/* ===============================
   DASHBOARD
================================ */

function renderDashboard(){
  dashboard.innerHTML=`
  <div class="card">
    <div class="phase ${getPhase().toLowerCase()}">${getPhase()}</div>
    <div class="stat">Week ${getWeek()}/10</div>
    <div class="stat">Projected 2KM: ${projected2km().toFixed(0)}s</div>
    <div class="stat">VO2 Est: ${vo2Estimate().toFixed(1)}</div>
    <div class="stat">ACWR: ${acwr()}</div>
    <div class="stat">Selection Index: ${selectionIndex().toFixed(0)}</div>
  </div>
  `;
}

/* ===============================
   WORKOUT + LOGGING
================================ */

function renderWorkout(){
  workout.innerHTML=`
  <div class="card">
    <h3>Today's Workout</h3>
    <pre>${getWorkout()}</pre>
    <input id="exercise" placeholder="Exercise Name">
    <input id="load" placeholder="Load">
    <input id="rpe" placeholder="RPE">
    <input id="left" placeholder="Left (unilateral)">
    <input id="right" placeholder="Right (unilateral)">
    <button onclick="saveSession(exercise.value,load.value,rpe.value,left.value,right.value)">Save</button>
  </div>
  `;
}

/* ===============================
   PR PANEL
================================ */

function renderPR(){
  const ex=document.getElementById("exercise")?.value||"";
  const pr=getPR(ex);
  prPanel.innerHTML=`
  <div class="card">
    <h3>PR Tracker</h3>
    <div>Exercise: ${ex||"-"}</div>
    <div>Best Load: ${pr}</div>
  </div>
  `;
}

/* ===============================
   10 WEEK ROADMAP
================================ */

function renderRoadmap(){
  roadmap.innerHTML=`
  <div class="card">
    <h3>10 Week Roadmap</h3>
    <div class="map-grid">
      ${Array.from({length:10}).map((_,i)=>`
        <div class="map-box ${i+1<=getWeek()?"active":""}"></div>
      `).join("")}
    </div>
  </div>
  `;
}

/* ===============================
   ANALYTICS
================================ */

function renderAnalytics(){
  const sessions=getSessions();
  analytics.innerHTML=`<div class="card"><canvas id="chart"></canvas></div>`;
  const labels=sessions.map((_,i)=>i+1);
  const data=sessions.map(s=>s.load);

  if(chart) chart.destroy();

  chart=new Chart(document.getElementById("chart"),{
    type:"line",
    data:{
      labels:labels,
      datasets:[{
        label:"Strength Progression",
        data:data,
        borderColor:"#18ff9c",
        tension:.3
      }]
    }
  });
}

/* ===============================
   MASTER RENDER
================================ */

function render(){
  renderDashboard();
  renderWorkout();
  renderPR();
  renderRoadmap();
  renderAnalytics();
}

render();

</script>
</body>
</html>
