<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRDV Tactical V15</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:#0b0f14;
  color:#fff;
}
header{
  padding:20px;
  font-weight:700;
  font-size:22px;
  color:#1ec97f;
  display:flex;
  justify-content:space-between;
}
.container{padding:18px;}
.card{
  background:#121922;
  padding:18px;
  border-radius:18px;
  margin-bottom:18px;
  box-shadow:0 0 25px rgba(0,0,0,.3);
}
.date-nav{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:15px;
}
button{
  background:#1ec97f;
  border:none;
  padding:10px 14px;
  border-radius:12px;
  font-weight:600;
}
.small-btn{
  background:#1f2b38;
  color:#fff;
}
input{
  width:100%;
  background:#0f151d;
  border:1px solid #1f2b38;
  padding:10px;
  border-radius:10px;
  margin-bottom:8px;
  color:#fff;
}
.exercise{
  margin-bottom:20px;
  padding:12px;
  background:#0f151d;
  border-radius:14px;
}
.timer{
  font-size:28px;
  font-weight:700;
  text-align:center;
  margin:10px 0;
}
.progress{
  font-size:14px;
  opacity:.6;
}
.green{color:#1ec97f}
.amber{color:#ffb020}
.red{color:#ff3b3b}
</style>
</head>

<body>

<header>
  PRDV Tactical V15
  <div id="countdown"></div>
</header>

<div class="container">

<div class="card">
  <div class="date-nav">
    <button class="small-btn" onclick="changeDate(-1)">◀</button>
    <div id="currentDate"></div>
    <button class="small-btn" onclick="changeDate(1)">▶</button>
  </div>
</div>

<div class="card">
  <h3>Readiness</h3>
  <input id="sleep" placeholder="Sleep (1-5)">
  <input id="soreness" placeholder="Soreness (1-5)">
  <input id="stress" placeholder="Stress (1-5)">
  <button onclick="updateReadiness()">Update</button>
  <div id="readinessStatus"></div>
</div>

<div id="workoutContainer"></div>

<div class="card">
  <button onclick="saveSession()">Save Session</button>
</div>

<div class="card">
  <h3>History</h3>
  <div id="history"></div>
</div>

</div>

<script>

const PRDV_DATE = new Date("2026-04-27");
let selectedDate = new Date();

function updateCountdown(){
  const diff = Math.ceil((PRDV_DATE - new Date())/(1000*60*60*24));
  document.getElementById("countdown").innerText = diff+" days";
}
updateCountdown();

function formatDate(date){
  return date.toDateString();
}

function changeDate(dir){
  selectedDate.setDate(selectedDate.getDate()+dir);
  renderDate();
}

function renderDate(){
  document.getElementById("currentDate").innerText = formatDate(selectedDate);
  renderWorkout();
  loadHistory();
}
renderDate();

function getWorkout(){
  const day = selectedDate.getDay();
  const twoKm = parseInt(localStorage.getItem("twoKm"))||470;
  const split = (twoKm/5).toFixed(1);

  if(day===2){
    return {
      title:"VO2 Intervals",
      exercises:[
        {name:"400m Run", sets:6, target:split+" sec", rest:90},
      ]
    }
  }

  if(day===1){
    return {
      title:"Lower Body Strength",
      exercises:[
        {name:"Bulgarian Split Squat", sets:4, target:"8 reps each leg", rest:90},
        {name:"Single Leg RDL", sets:4, target:"8 reps", rest:90}
      ]
    }
  }

  return {
    title:"Zone 2 Conditioning",
    exercises:[
      {name:"Steady Run", sets:1, target:"70-90 min Z2", rest:0}
    ]
  }
}

function renderWorkout(){
  const data = getWorkout();
  const container = document.getElementById("workoutContainer");
  container.innerHTML="";

  const card = document.createElement("div");
  card.className="card";
  card.innerHTML="<h2>"+data.title+"</h2>";
  container.appendChild(card);

  data.exercises.forEach((ex,i)=>{
    const div = document.createElement("div");
    div.className="exercise";
    div.innerHTML=`
      <h4>${ex.name}</h4>
      <div class="progress">Target: ${ex.target} | Rest: ${ex.rest}s</div>
      <input id="weight${i}" placeholder="Weight">
      <input id="reps${i}" placeholder="Reps / Time / Distance">
      <div class="timer" id="timer${i}">00:00</div>
      <button onclick="startTimer(${i},${ex.rest})">Start</button>
    `;
    card.appendChild(div);
  });
}

let timers={};

function startTimer(i,rest){
  let seconds=0;
  const display=document.getElementById("timer"+i);
  clearInterval(timers[i]);
  timers[i]=setInterval(()=>{
    seconds++;
    display.innerText=formatTime(seconds);
  },1000);

  if(rest>0){
    setTimeout(()=>{
      alert("Rest period begins");
    },1000);
  }
}

function formatTime(sec){
  let m=Math.floor(sec/60);
  let s=sec%60;
  return (m<10?"0":"")+m+":"+(s<10?"0":"")+s;
}

function updateReadiness(){
  const sleep=parseInt(sleep.value)||3;
  const sore=parseInt(soreness.value)||3;
  const stress=parseInt(stress.value)||3;
  const score = sleep + (6-sore) + (6-stress);
  let state="GREEN";
  if(score<8) state="RED";
  else if(score<12) state="AMBER";
  document.getElementById("readinessStatus").innerHTML=
    "<div class='"+state.toLowerCase()+"'>"+state+" ("+score+")</div>";
}

function saveSession(){
  const key="session-"+selectedDate.toDateString();
  const workout=getWorkout();
  let record={date:selectedDate.toDateString(),workout:workout.title,logs:[]};

  workout.exercises.forEach((ex,i)=>{
    record.logs.push({
      exercise:ex.name,
      weight:document.getElementById("weight"+i).value,
      reps:document.getElementById("reps"+i).value
    });
  });

  localStorage.setItem(key,JSON.stringify(record));
  alert("Session saved");
  loadHistory();
}

function loadHistory(){
  const history=document.getElementById("history");
  history.innerHTML="";
  for(let i=0;i<localStorage.length;i++){
    const key=localStorage.key(i);
    if(key.startsWith("session-")){
      const data=JSON.parse(localStorage.getItem(key));
      history.innerHTML+=`
        <div class="progress">${data.date} – ${data.workout}</div>
      `;
    }
  }
}

</script>

</body>
</html>
